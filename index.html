<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ordefy - E-commerce Management Dashboard</title>
    <meta name="description" content="Professional e-commerce management platform. Manage orders, products, inventory, and analytics all in one place. Developed by Bright Idea." />
    <meta name="author" content="Bright Idea" />
    <meta name="theme-color" content="hsl(0, 0%, 98%)" />

    <!-- Shopify App Bridge (2025 Modern Setup with sessionStorage) -->
    <script>
      (function() {
        // Get parameters from URL
        const urlParams = new URLSearchParams(window.location.search);
        const shop = urlParams.get('shop');
        const host = urlParams.get('host');
        const embedded = urlParams.get('embedded');

        // Save to sessionStorage if present (for navigation persistence)
        if (shop) sessionStorage.setItem('shopify_shop', shop);
        if (host) sessionStorage.setItem('shopify_host', host);
        if (embedded) sessionStorage.setItem('shopify_embedded', embedded);

        // Try to get from sessionStorage if not in URL
        const savedShop = shop || sessionStorage.getItem('shopify_shop');
        const savedHost = host || sessionStorage.getItem('shopify_host');
        const savedEmbedded = embedded || sessionStorage.getItem('shopify_embedded');

        // Determine if we're in embedded mode
        const isEmbedded = !!(savedShop || savedHost || savedEmbedded === '1');

        if (isEmbedded) {
          console.log('[Shopify] Embedded mode detected');

          // Inject meta tags
          const apiKeyMeta = document.createElement('meta');
          apiKeyMeta.name = 'shopify-api-key';
          apiKeyMeta.content = '75123c29296179fbd8f253db4196c83b';
          document.head.appendChild(apiKeyMeta);

          // Inject shop meta if available
          if (savedShop) {
            const shopMeta = document.createElement('meta');
            shopMeta.name = 'shopify-shop';
            shopMeta.content = savedShop;
            document.head.appendChild(shopMeta);
            console.log('[Shopify] Shop domain:', savedShop);
          }

          // Inject host meta if available
          if (savedHost) {
            const hostMeta = document.createElement('meta');
            hostMeta.name = 'shopify-host';
            hostMeta.content = savedHost;
            document.head.appendChild(hostMeta);
          }

          // Load App Bridge script
          const script = document.createElement('script');
          script.src = 'https://cdn.shopify.com/shopifycloud/app-bridge.js';
          script.async = false; // Load synchronously
          document.head.appendChild(script);

          console.log('[Shopify] App Bridge loading...');
        } else {
          console.log('[Shopify] Standalone mode - App Bridge disabled');
        }
      })();
    </script>

    <!-- Prevent flash of unstyled content for dark mode -->
    <script>
      (function() {
        const theme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (theme === 'dark' || (!theme && prefersDark)) {
          document.documentElement.classList.add('dark');
          document.querySelector('meta[name="theme-color"]')?.setAttribute('content', 'hsl(240, 10%, 8%)');
        } else {
          document.documentElement.classList.add('light');
        }
      })();
    </script>

    <meta property="og:title" content="Ordefy - E-commerce Management Dashboard" />
    <meta property="og:description" content="Professional e-commerce management platform. Manage orders, products, inventory, and analytics all in one place." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://ordefy.io" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ordefy - E-commerce Management Dashboard" />
    <meta name="twitter:description" content="Professional e-commerce management platform by Bright Idea" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
