<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ordefy - E-commerce Management Dashboard</title>
    <meta name="description" content="Professional e-commerce management platform. Manage orders, products, inventory, and analytics all in one place. Developed by Bright Idea." />
    <meta name="author" content="Bright Idea" />
    <meta name="theme-color" content="hsl(0, 0%, 98%)" />

    <!-- ===================================================================== -->
    <!-- SHOPIFY APP BRIDGE (AGGRESSIVE LOADER - FINAL VERSION)                -->
    <!-- Fuerza la carga en iframe, persiste sesi√≥n y configura Host expl√≠cito -->
    <!-- ===================================================================== -->
    <script>
      (function() {
        console.log('üöÄ [SHOPIFY] === AGGRESSIVE APP BRIDGE LOADER ===');

        // 1. Detectar si estamos en iframe
        const isInIframe = window.top !== window.self;
        
        if (!isInIframe) {
          console.log('üè† [SHOPIFY] Standalone mode - App Bridge disabled');
          return; 
        }

        console.log('ü™ü [SHOPIFY] IFRAME DETECTED - FORCE LOADING APP BRIDGE');
        window.__SHOPIFY_EMBEDDED__ = true;

        // 2. Obtener par√°metros (URL o SessionStorage)
        const urlParams = new URLSearchParams(window.location.search);
        const shop = urlParams.get('shop');
        const host = urlParams.get('host');
        
        // 3. Persistir en SessionStorage
        if (shop) sessionStorage.setItem('shopify_shop', shop);
        if (host) sessionStorage.setItem('shopify_host', host);

        // 4. Recuperar valores finales
        const savedShop = shop || sessionStorage.getItem('shopify_shop');
        const savedHost = host || sessionStorage.getItem('shopify_host');

        // 5. Inyectar Meta Tag de API Key (OBLIGATORIO)
        // Usamos la clave correcta del Dashboard: e4ac05aaca557fdb387681f0f209335d
        const apiKeyMeta = document.createElement('meta');
        apiKeyMeta.name = 'shopify-api-key';
        apiKeyMeta.content = 'e4ac05aaca557fdb387681f0f209335d';
        document.head.appendChild(apiKeyMeta);
        console.log('‚úÖ [SHOPIFY] API key meta tag injected (e4ac...)');

        // 6. Inyectar Meta Tags opcionales (Shop/Host)
        if (savedShop) {
          const shopMeta = document.createElement('meta');
          shopMeta.name = 'shopify-shop';
          shopMeta.content = savedShop;
          document.head.appendChild(shopMeta);
        }

        if (savedHost) {
          const hostMeta = document.createElement('meta');
          hostMeta.name = 'shopify-host';
          hostMeta.content = savedHost;
          document.head.appendChild(hostMeta);
        }

        // 7. Cargar Script de App Bridge
        console.log('üìú [SHOPIFY] Loading App Bridge script...');
        const script = document.createElement('script');
        script.src = 'https://cdn.shopify.com/shopifycloud/app-bridge.js';
        script.async = false; // S√≠ncrono para asegurar carga inmediata

        // 8. Configuraci√≥n Expl√≠cita (CRUCIAL para evitar Timeouts)
        // Inyectamos data-host y data-shop manualmente
        if (savedHost) script.setAttribute('data-host', savedHost);
        if (savedShop) script.setAttribute('data-shop', savedShop);

        script.onload = function() {
          console.log('‚úÖ [SHOPIFY] APP BRIDGE SCRIPT LOADED!');
          console.log('‚úÖ [SHOPIFY] window.shopify exists:', !!window.shopify);
        };

        script.onerror = function(error) {
          console.error('‚ùå [SHOPIFY] FAILED TO LOAD APP BRIDGE SCRIPT:', error);
        };

        document.head.appendChild(script);
      })();
    </script>

    <!-- Prevent flash of unstyled content for dark mode -->
    <script>
      (function() {
        const theme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (theme === 'dark' || (!theme && prefersDark)) {
          document.documentElement.classList.add('dark');
          document.querySelector('meta[name="theme-color"]')?.setAttribute('content', 'hsl(240, 10%, 8%)');
        } else {
          document.documentElement.classList.add('light');
        }
      })();
    </script>

    <meta property="og:title" content="Ordefy - E-commerce Management Dashboard" />
    <meta property="og:description" content="Professional e-commerce management platform. Manage orders, products, inventory, and analytics all in one place." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://ordefy.io" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Ordefy - E-commerce Management Dashboard" />
    <meta name="twitter:description" content="Professional e-commerce management platform by Bright Idea" />
  </head>

  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>